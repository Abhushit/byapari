{"ast":null,"code":"import _defineProperty from\"/opt/lampp/htdocs/react_1/group24_first/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/opt/lampp/htdocs/react_1/group24_first/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/opt/lampp/htdocs/react_1/group24_first/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/opt/lampp/htdocs/react_1/group24_first/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/opt/lampp/htdocs/react_1/group24_first/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/opt/lampp/htdocs/react_1/group24_first/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import*as io from\"socket.io-client\";import{Icon}from\"@iconify/react\";import sendOutlined from\"@iconify/icons-ant-design/send-outlined\";import dateUtil from\"./../../util/dateUtil\";import notify from'./../../util/notify';import\"./chat.component.css\";var ChatComponent=/*#__PURE__*/function(_Component){_inherits(ChatComponent,_Component);var _super=_createSuper(ChatComponent);function ChatComponent(){var _this;_classCallCheck(this,ChatComponent);_this=_super.call(this);_this.handleChange=function(e){var _e$target=e.target,name=_e$target.name,value=_e$target.value;_this.setState(function(pre){return{data:_objectSpread(_objectSpread({},pre.data),{},_defineProperty({},name,value))};});};_this.handleSubmit=function(e){e.preventDefault();var data=_this.state.data;if(!data.receiverId){return notify.showInfo('Please select a user to continue');}data.time=new Date();data.senderName=_this.state.currentUser.username;_this.socket.emit(\"new-msg\",data);_this.setState(function(pre){return{data:_objectSpread(_objectSpread({},pre.data),{},{message:\"\"})};});};_this.state={data:{message:\"\",senderId:\"\",receiverId:\"\",time:\"\",senderName:\"\",receiverName:\"\"},messages:[],users:[],currentUser:null};return _this;}_createClass(ChatComponent,[{key:\"componentDidMount\",value:function componentDidMount(){this.socket=io.connect(process.env.REACT_APP_SOCKET_URL);this.runSocket();var currentUser=JSON.parse(localStorage.getItem(\"user\"));this.socket.emit(\"new-user\",currentUser.username);this.setState({currentUser:currentUser});}},{key:\"runSocket\",value:function runSocket(){var _this2=this;this.socket.on(\"reply-msg\",function(messageData){var _this2$state=_this2.state,messages=_this2$state.messages,data=_this2$state.data;messages.push(messageData);//swap sender as receiver\ndata.receiverId=messageData.senderId;_this2.setState({messages:messages,data:data});});this.socket.on(\"reply-msg-own\",function(messageData){var messages=_this2.state.messages;messages.push(messageData);_this2.setState({messages:messages});});this.socket.on(\"users\",function(users){_this2.setState({users:users});});}},{key:\"selectUser\",value:function selectUser(selectedUserId){this.setState(function(pre){return{data:_objectSpread(_objectSpread({},pre.data),{},{receiverId:selectedUserId})};});}},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/React.createElement(\"div\",{className:\"\"},/*#__PURE__*/React.createElement(\"h2\",null,\"Let's Chat\"),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-6\"},/*#__PURE__*/React.createElement(\"ins\",null,\"Messages\"),/*#__PURE__*/React.createElement(\"div\",{className:\"chat_block\"},/*#__PURE__*/React.createElement(\"div\",{className:\"sender-name\"},/*#__PURE__*/React.createElement(\"p\",null,\"Chat with\",\" \",this.state.currentUser&&this.state.currentUser.username)),/*#__PURE__*/React.createElement(\"ul\",null,this.state.messages.map(function(message,i){return/*#__PURE__*/React.createElement(\"li\",{key:i},/*#__PURE__*/React.createElement(\"p\",{class:\"current-user\"},message.senderName),/*#__PURE__*/React.createElement(\"p\",null,message.message),/*#__PURE__*/React.createElement(\"p\",{className:\"light\"},dateUtil.relativeTime(message.time)));})),/*#__PURE__*/React.createElement(\"form\",{className:\"form-group form-div\",onSubmit:this.handleSubmit},/*#__PURE__*/React.createElement(\"input\",{type:\"text\",name:\"message\",value:this.state.data.message,className:\"form-control input-class\",placeholder:\"your message here...\",onChange:this.handleChange}),/*#__PURE__*/React.createElement(\"button\",{className:\"btn-send\",type:\"submit\"},/*#__PURE__*/React.createElement(Icon,{icon:sendOutlined}))))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-6\"},/*#__PURE__*/React.createElement(\"ins\",null,\"Users\"),/*#__PURE__*/React.createElement(\"div\",{className:\"chat_block\"},/*#__PURE__*/React.createElement(\"ul\",null,this.state.users.map(function(user,index){return/*#__PURE__*/React.createElement(\"li\",{key:index},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-default\",onClick:function onClick(){return _this3.selectUser(user.id);}},user.name));}))))));}}]);return ChatComponent;}(Component);export{ChatComponent as default};","map":{"version":3,"sources":["/opt/lampp/htdocs/react_1/group24_first/src/components/common/chat/chat.component.js"],"names":["React","Component","io","Icon","sendOutlined","dateUtil","notify","ChatComponent","handleChange","e","target","name","value","setState","pre","data","handleSubmit","preventDefault","state","receiverId","showInfo","time","Date","senderName","currentUser","username","socket","emit","message","senderId","receiverName","messages","users","connect","process","env","REACT_APP_SOCKET_URL","runSocket","JSON","parse","localStorage","getItem","on","messageData","push","selectedUserId","map","i","relativeTime","user","index","selectUser","id"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport * as io from \"socket.io-client\";\nimport { Icon } from \"@iconify/react\";\nimport sendOutlined from \"@iconify/icons-ant-design/send-outlined\";\nimport dateUtil from \"./../../util/dateUtil\";\nimport notify from './../../util/notify'\nimport \"./chat.component.css\";\n\nexport default class ChatComponent extends Component {\n  constructor() {\n    super();\n    this.state = {\n      data: {\n        message: \"\",\n        senderId: \"\",\n        receiverId: \"\",\n        time: \"\",\n        senderName: \"\",\n        receiverName: \"\",\n      },\n      messages: [],\n      users: [],\n      currentUser: null,\n    };\n  }\n  componentDidMount() {\n    this.socket = io.connect(process.env.REACT_APP_SOCKET_URL);\n    this.runSocket();\n    let currentUser = JSON.parse(localStorage.getItem(\"user\"));\n    this.socket.emit(\"new-user\", currentUser.username);\n    \n    this.setState({\n      currentUser,\n    });\n  }\n\n  handleChange = (e) => {\n    const { name, value } = e.target;\n    this.setState((pre) => ({\n      data: {\n        ...pre.data,\n        [name]: value,\n      },\n    }));\n  };\n\n  handleSubmit = (e) => {\n    e.preventDefault();\n\n    const { data } = this.state;\n    if(!data.receiverId){\n      return notify.showInfo('Please select a user to continue');\n    }\n    data.time = new Date();\n    data.senderName = this.state.currentUser.username;\n    this.socket.emit(\"new-msg\", data);\n    this.setState((pre) => ({\n      data: {\n        ...pre.data,\n        message: \"\",\n      },\n    }));\n  };\n\n  runSocket() {\n    this.socket.on(\"reply-msg\", (messageData) => {\n      const { messages,data } = this.state;\n      messages.push(messageData);\n      //swap sender as receiver\n      data.receiverId = messageData.senderId;\n      this.setState({\n        messages,\n        data\n      });\n    });\n\n    this.socket.on(\"reply-msg-own\", (messageData) => {\n      const { messages } = this.state;\n      messages.push(messageData);\n      this.setState({\n        messages,\n      });\n    });\n\n\n    this.socket.on(\"users\", (users) => {\n      this.setState({\n        users,\n      });\n    });\n  }\n\n  selectUser(selectedUserId){\n    this.setState(pre => ({\n      data: {\n        ...pre.data,\n        receiverId: selectedUserId\n      }\n    }))\n  }\n\n  render() {\n    return (\n      <div className=\"\">\n        <h2>Let's Chat</h2>\n        <div className=\"row\">\n          <div className=\"col-md-6\">\n            <ins>Messages</ins>\n            <div className=\"chat_block\">\n              <div className=\"sender-name\">\n                <p>\n                  Chat with{\" \"}\n                  {this.state.currentUser && this.state.currentUser.username}\n                </p>\n              </div>\n              <ul>\n                {this.state.messages.map((message, i) => (\n                  <li key={i}>\n                    <p class=\"current-user\">{message.senderName}</p>\n                    <p>{message.message}</p>\n                    <p className=\"light\">\n                      {dateUtil.relativeTime(message.time)}\n                    </p>\n                  </li>\n                ))}\n              </ul>\n              <form\n                className=\"form-group form-div\"\n                onSubmit={this.handleSubmit}\n              >\n                <input\n                  type=\"text\"\n                  name=\"message\"\n                  value={this.state.data.message}\n                  className=\"form-control input-class\"\n                  placeholder=\"your message here...\"\n                  onChange={this.handleChange}\n                />\n                <button className=\"btn-send\" type=\"submit\">\n                  <Icon icon={sendOutlined} />\n                </button>\n              </form>\n            </div>\n          </div>\n          <div className=\"col-md-6\">\n            <ins>Users</ins>\n            <div className=\"chat_block\">\n              <ul>\n                {this.state.users.map((user, index) => (\n                  <li key={index}>\n                    <button\n                      className=\"btn btn-default\"\n                      onClick={() => this.selectUser(user.id)}\n                    >\n                      {user.name}\n                    </button>\n                  </li>\n                ))}\n              </ul>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}